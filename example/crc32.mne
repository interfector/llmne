#!/usr/local/bin/llmne -x

ONESC CRC
POP CRC

TABLE_LOOP:

PUSH OP+2
CMP OP+3
JZ CRC_LOOP

POP $$+1
ONESC CRC_TABLE
ADD ONE
POP CRC_TABLE+8

INC OP+2
INC TABLE_LOOP+6

JMP TABLE_LOOP

CRC_LOOP:

PUSH ARRAY
CMP EOT
JZ CRC_END

XOR CRC
AND VAL
POP TBL_IDX

PUSH OP+1
ADD TBL_IDX
POP $$+3

PUSH CRC
SHR VAL2
XOR CRC_TABLE
POP CRC

PUSH ARRAY
SHR VAL2
XOR CRC
AND VAL
POP TBL_IDX

PUSH OP+1
ADD TBL_IDX
POP $$+3

PUSH CRC
SHR VAL2
XOR CRC_TABLE
POP CRC

INC CRC_LOOP+1

JMP CRC_LOOP

CRC_END:

DISPLAY HEX
WRITE CRC

EXIT 0

CRC:
0000

VAL:
0015
VAL2:
0004

TBL_IDX:
0000

CRC_TABLE:
000000000
498536548
997073096
651767980
1994146192
1802195444
1303535960
1342533948
306674912
267414716
690576408
882789492
1687895376
2032938284
1609899400
1111625188
#0
#498536548
#997073096
#651767980
#1994146192
#1802195444
#1303535960
#1342533948
#-306674912
#-267414716
#-690576408
#-882789492
#-1687895376
#-2032938284
#-1609899400
#-1111625188

OP:
READ ARRAY
XOR CRC_TABLE
ONESC CRC_TABLE+8
ONESC CRC_TABLE+15 #16

ONE:
0001

EOT:
0010

ARRAY:
0072 'H'
0069 'E'
0076 'L'
0076 'L'
0079 'O'
#0010 '\n'
