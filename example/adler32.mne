#!/usr/local/bin/llmne -x

STPUSH OP
CALL READL

POP COUNT

ADLER_LOOP:

PUSH I
CMP COUNT
JZ ADLER_END

PUSH ARRAY
ADD A
MOD MADLER
POP A

PUSH B
ADD A
MOD MADLER
POP B

INC ADLER_LOOP+3
INC I

JMP ADLER_LOOP

ADLER_END:

PUSH B
SHL VAL
OR A
POP VAL

DISPLAY HEX
WRITE VAL

EXIT 0

VAL:
0016

A:
0001
B:
0000
MADLER:
65521

I:
0000

COUNT:
0000

OP:
READ ARRAY

# READL function starts

EOT:
0010

READL:

SUBSP 1

DISPLAY CHAR
STPOP READ_LOOP
PUSH READ_LOOP
ADD RGAP
POP READ_LOOP+1
POP COUNT

READ_LOOP:
READ STRING
PUSH STRING

CMP EOT
JZ READ_END

INC READ_LOOP
INC READ_LOOP+1

JMP READ_LOOP

READ_END:
PUSH READ_LOOP+1
SUB COUNT
ADDSP 1
DISPLAY INT
RET

RGAP:
0300 # difference between 'PUSH 00' and 'READ 00'

COUNT:
0000

# READL function ends

ARRAY:
0000
