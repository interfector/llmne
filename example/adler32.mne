#!/usr/local/bin/llmne -x

STPUSH OP
CALL READL

SAVE COUNT

ADLER_LOOP:

LOAD I
CMP COUNT
JZ ADLER_END

LOAD ARRAY
ADD A
MOD MADLER
SAVE A

LOAD B
ADD A
MOD MADLER
SAVE B

INC ADLER_LOOP+3
INC I

JMP ADLER_LOOP

ADLER_END:

LOAD B
SHL VAL
OR A
SAVE VAL

DISPLAY HEX
WRITE VAL

EXIT 0

VAL:
0016

A:
0001
B:
0000
MADLER:
65521

I:
0000

COUNT:
0000

OP:
READ ARRAY

# READL function starts

EOT:
0010

READL:

SUBSP 1

DISPLAY CHAR
STPOP READ_LOOP
LOAD READ_LOOP
ADD RGAP
SAVE READ_LOOP+1
SAVE COUNT

READ_LOOP:
READ STRING
LOAD STRING

CMP EOT
JZ READ_END

INC READ_LOOP
INC READ_LOOP+1

JMP READ_LOOP

READ_END:
LOAD READ_LOOP+1
SUB COUNT
ADDSP 1
DISPLAY INT
RET

RGAP:
0300 # difference between 'PUSH 00' and 'READ 00'

COUNT:
0000

# READL function ends

ARRAY:
0000
